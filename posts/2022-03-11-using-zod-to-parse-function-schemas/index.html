<!DOCTYPE html>
<html lang="en" data-theme="fantasy">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Tyler Hall - Fullstack Web Developer</title>
    <base href="/">

    

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Tyler Hall - Web Developer, hyper Core team, Open Source Project Maintainer">
    <meta name="keywords" content="Tyler Hall, Blog, JavaScript, Hyper, GraphQL, Deno, Svelte, React, ADT, Functional">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/theme-change@2.0.2/index.js"></script>  
  <link rel="stylesheet" href="/assets/asset.f9ff5973.css"></link>
</head>

  <body>
    <div class="navbar bg-base-100">
  <div class="flex-1">
    <div class="flex justify-center space-around py-2 space-x-4">
      <a href="/" class="font-bold">Tyler Hall</a>
    </div>
  </div>
  <div class="flex-none">
    <ul class="menu menu-horizontal p-0 space-around space-x-4">
      <li>
        <a role="button" href="/about" title="About Me" class="">
  
          About
        
</a>
      </li>
      <div title="Change Theme" class="dropdown dropdown-end">
  <div tabindex="0" class="btn gap-2 normal-case btn-ghost">
    <!-- Swatch -->
    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block h-5 w-5 stroke-current md:h-6 md:w-6">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01">
      </path>
    </svg>
    <span class="hidden md:inline">Change Theme</span>
    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792" class="ml-1 inline-block h-4 w-4 fill-current">
      <path d="M1395 736q0 13-10 23l-466 466q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l50-50q10-10 23-10t23 10l393 393 393-393q10-10 23-10t23 10l50 50q10 10 10 23z">
      </path>
    </svg>
  </div>
  <div class="dropdown-content bg-base-200 text-base-content rounded-t-box rounded-b-box top-px h-96 w-52 overflow-y-auto shadow-2xl mt-16">
    <ul class="menu menu-compact p-4" tabindex="0">
      <li><button data-set-theme="fantasy" data-act-class="active" class="active">🧚‍♀️  fantasy</button></li>
      <li><button data-set-theme="black" data-act-class="active">🏴  black</button></li>
      <li><button data-set-theme="lisght" data-act-class="active">🌝  light</button></li>
      <li><button data-set-theme="dark" data-act-class="active">🌚  dark</button></li>
      <li><button data-set-theme="cupcake" data-act-class="active" class="">🧁  cupcake</button></li>
      <li><button data-set-theme="bumblebee" data-act-class="active" class="">🐝  bumblebee</button></li>
      <li><button data-set-theme="emerald" data-act-class="active" class="">✳️  Emerald</button></li>
      <li><button data-set-theme="corporate" data-act-class="active" class="">🏢  Corporate</button></li>
      <li><button data-set-theme="synthwave" data-act-class="active">🌃  synthwave</button></li>
      <li><button data-set-theme="retro" data-act-class="active" class="">👴  retro</button></li>
      <li><button data-set-theme="cyberpunk" data-act-class="active" class="">🤖  cyberpunk</button></li>
      <li><button data-set-theme="valentine" data-act-class="active" class="">🌸  valentine</button></li>
      <li><button data-set-theme="halloween" data-act-class="active" class="">🎃  halloween</button></li>
      <li><button data-set-theme="garden" data-act-class="active">🌷  garden</button></li>
      <li><button data-set-theme="forest" data-act-class="active">🌲  forest</button></li>
      <li><button data-set-theme="aqua" data-act-class="active">🐟  aqua</button></li>
      <li><button data-set-theme="lofi" data-act-class="active">👓  lofi</button></li>
      <li><button data-set-theme="pastel" data-act-class="active">🖍  pastel</button></li>
      <li><button data-set-theme="wireframe" data-act-class="active">📝  Wireframe</button></li>
      <li><button data-set-theme="luxury" data-act-class="active">💎  luxury</button></li>
      <li><button data-set-theme="dracula" data-act-class="active">🧛‍♂️  dracula</button></li>
      <li><button data-set-theme="cmyk" data-act-class="active">🖨  CMYK</button></li>
      <li><button data-set-theme="autumn" data-act-class="active">🍁  Autumn</button></li>
      <li><button data-set-theme="business" data-act-class="active">💼  Business</button></li>
      <li><button data-set-theme="acid" data-act-class="active">💊  Acid</button></li>
      <li><button data-set-theme="lemonade" data-act-class="active">🍋  Lemonade</button></li>
      <li><button data-set-theme="night" data-act-class="active">🌙  Night</button></li>
      <li><button data-set-theme="coffee" data-act-class="active">☕️  Coffee</button></li>
      <li><button data-set-theme="winter" data-act-class="active">❄️  Winter</button></li>
    </ul>
  </div>
</div>

      <li>
        <div>
          <a href="https://github.com/TillaTheHun0" title="GitHub">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="inline-block h-5 w-5 fill-current md:h-6 md:w-6">
              <path d="M256,32C132.3,32,32,134.9,32,261.7c0,101.5,64.2,187.5,153.2,217.9a17.56,17.56,0,0,0,3.8.4c8.3,0,11.5-6.1,11.5-11.4,0-5.5-.2-19.9-.3-39.1a102.4,102.4,0,0,1-22.6,2.7c-43.1,0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1,1.4-14.1h.1c22.5,2,34.3,23.8,34.3,23.8,11.2,19.6,26.2,25.1,39.6,25.1a63,63,0,0,0,25.6-6c2-14.8,7.8-24.9,14.2-30.7-49.7-5.8-102-25.5-102-113.5,0-25.1,8.7-45.6,23-61.6-2.3-5.8-10-29.2,2.2-60.8a18.64,18.64,0,0,1,5-.5c8.1,0,26.4,3.1,56.6,24.1a208.21,208.21,0,0,1,112.2,0c30.2-21,48.5-24.1,56.6-24.1a18.64,18.64,0,0,1,5,.5c12.2,31.6,4.5,55,2.2,60.8,14.3,16.1,23,36.6,23,61.6,0,88.2-52.4,107.6-102.3,113.3,8,7.1,15.2,21.1,15.2,42.5,0,30.7-.3,55.5-.3,63,0,5.4,3.1,11.5,11.4,11.5a19.35,19.35,0,0,0,4-.4C415.9,449.2,480,363.1,480,261.7,480,134.9,379.7,32,256,32Z"></path>
            </svg>
          </a>
        </div>
      </li>
    </ul>
  </div>
</div>
      <main class="flex flex-grow justify-center min-h-screen p-4">
        <div class="flex flex-grow justify-center min-h-screen">
    <article class="w-screen max-w-4xl p-8">
      <h1 class="text-primary text-2xl">Using Zod to Parse Function Schemas</h1>

      <span class="font-light text-sm bg-accent text-accent-content my-2">
        March 11, 2022 - 5 min read
      </span>

      <div class="divider"></div>

      <p>Data validation, ensuring the data your system receives is in some expected shape, is crucial for a mature system. The most important part of a system, the business logic, expects and provides data in a particular shape, and so validating these shapes is an important part of running and testing your business logic.</p><p>There are a ton of options. TypeScript is widely used and will provide compile time checks on your code. Most systems require <em>runtime</em> validation at its boundaries. For example, I may have a web server endpoint that expects a certain payload shape that it will need to validate, at runtime. I can’t use TypeScript for that. In addition, TypeScript adds a build step (unless you use <a href="https://deno.land/">Deno</a> 🙂), and TypeScript checking can be bypassed using catchall types like <code>any</code> and <code>unknown</code>. I can disallow those types, using <code>strict</code>, but I now am beholden to library types, types I don’t have control over or may be incorrect. So then using the <code>any</code> escape-hatch becomes an exercise in design and discipline, for each dev that works on the system. At the very least, that’s cognitive overhead that can’t be ignored, and at its worst, an obstacle to delivering quality software.</p><blockquote>
<p>My last points were not to knock TypeScript, it’s great and we use it. My point is that <strong>it takes experience and discernment to know where TypeScript is a boon, and where TypeScript is an obstacle</strong>. TypeScript catches <em>tons</em> of common bugs, but it’s just another tool in the toolbox. It takes a good developer to decide how and when, and to what extent, to use it.</p>
</blockquote><p>So regardless of using compile time checks, we need some way to validate data shape at runtime, so that bad data doesn’t get into the crucial parts of the system. There are tons of runtime options. <a href="https://github.com/sideway/joi">Joi</a> or <a href="https://github.com/jquense/yup">Yup</a> are both great runtime options. At hyper, we use a library called <a href="https://github.com/colinhacks/zod">Zod</a>.</p><h2 id="at-hyper">At hyper</h2><p>The hyper service framework we’ve built at hyper, uses a “Ports and Adapters” architecture, also known as <a href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)">Hexagonal Architecture</a>. This allows swapping out the underlying components that power hyper services, without having to change the hyper core.</p><p>To accomplish this architecture, hyper core must specify a contract or “port”, for each service that it offers. Then a service adapter must implement one of those ports in order to be used by hyper core:</p><img src="https://blog.hyper.io/content/images/2021/05/hyper-architecture.png"><p>Each of these ports are published modules. You can see hyper’s data port <a href="https://nest.land/package/hyper-port-data">here</a>. All service ports are implemented using <code>zod</code>. We define a Zod <code>schema</code> for the adapter object. Then, given an adapter implementation, the port wraps each function implemented by the adapter with the corresponding <code>z.function()</code> schema that enforces the contract between hyper core and the hyper adapter. <code>Zod</code> even has a feature that allows <a href="https://github.com/colinhacks/zod#type-inference">TypeScript type inference from schemas</a>!</p><p><code>function</code> schemas are a really cool feature of <code>zod</code> as they allow for separating the validation logic from the “meat” of the implementation. Adapters don’t have to worry about validating inputs and outputs for each function implemented; hyper core does that. In fact, as an adapter developer, you can use the hyper port as part of your unit tests, ensuring your adapter returns the proper responses for each api!</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { data } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;https://x.nest.land/hyper-port-data@1.2.0/mod.js&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">// wrap your impl with the port</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">myDataAdapter</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">data</span><span style="color: #C9D1D9">({</span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/**</span></span>
<span class="line"><span style="color: #8B949E"> * Now simply assert each api call,</span></span>
<span class="line"><span style="color: #8B949E"> * and Zod parses the inputs and outputs.</span></span>
<span class="line"><span style="color: #8B949E"> * If the test doesn&#39;t throw,</span></span>
<span class="line"><span style="color: #8B949E"> * you know you&#39;ve implemented the port!</span></span>
<span class="line"><span style="color: #8B949E"> */</span></span>
<span class="line"><span style="color: #D2A8FF">test</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;should return the correct shapes&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">assert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> myDataAdapter.</span><span style="color: #D2A8FF">createDatabase</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;foo&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">...</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre><p>This is precisely how hyper core wraps each adapter.</p><h2 id="a-function-schema">A function schema</h2><p>A <code>function</code> schema in <code>zod</code> looks like this:</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MyFunctionSchema</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> z.</span><span style="color: #D2A8FF">function</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">args</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    z.</span><span style="color: #D2A8FF">string</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  )</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">returns</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    z.</span><span style="color: #D2A8FF">promise</span><span style="color: #C9D1D9">(z.</span><span style="color: #D2A8FF">object</span><span style="color: #C9D1D9">({ ok: z.</span><span style="color: #D2A8FF">boolean</span><span style="color: #C9D1D9">() }))</span></span>
<span class="line"><span style="color: #C9D1D9">  )</span></span></code></pre><p>You can then pass a function to the schema’s <code>implement</code> method, which returns a new function that automatically validates its inputs and outputs:</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">businessLogic</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">str</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9"> </span><span style="color: #8B949E">// do some stuff</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Promise</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">resolve</span><span style="color: #C9D1D9">({ ok: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> })</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">withValidation</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> MyFunctionSchema</span></span>
<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">implement</span><span style="color: #C9D1D9">(businessLogic)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D2A8FF">withValidation</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;foo&#39;</span><span style="color: #C9D1D9">) </span><span style="color: #8B949E">// passes</span></span>
<span class="line"><span style="color: #D2A8FF">withValidation</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">123</span><span style="color: #C9D1D9">) </span><span style="color: #8B949E">// throws ZodError because input doesn&#39;t match schema</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">MyFunctionSchema.</span><span style="color: #D2A8FF">implement</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">   </span><span style="color: #FFA657">str</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Promise</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">resolve</span><span style="color: #C9D1D9">({ not_ok: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9"> })</span></span>
<span class="line"><span style="color: #C9D1D9">)(</span><span style="color: #A5D6FF">&#39;foo&#39;</span><span style="color: #C9D1D9">) </span><span style="color: #8B949E">// throws ZodError because output doesn&#39;t match schema</span></span></code></pre><h3 id="function-overloading">Function overloading</h3><p>You may have a function that supports multiple input shapes and multiple output shapes. <code>Zod</code> does have support for <a href="https://github.com/colinhacks/zod#unions">Union types</a> which works as a sort of logical OR type, And you could use those to build a function schema:</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">stringOrNumber</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> z.</span><span style="color: #D2A8FF">union</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">  [z.</span><span style="color: #D2A8FF">string</span><span style="color: #C9D1D9">(), z.</span><span style="color: #D2A8FF">number</span><span style="color: #C9D1D9">()]</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">identity</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> z.</span><span style="color: #D2A8FF">function</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">args</span><span style="color: #C9D1D9">(stringOrNumber)</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">returns</span><span style="color: #C9D1D9">(stringOrNumber)</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">implement</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">i</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> i)</span></span>
<span class="line"><span style="color: #C9D1D9">  </span></span>
<span class="line"><span style="color: #8B949E">// equivalent TS type</span></span>
<span class="line"><span style="color: #FF7B72">type</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">stringOrNumberIdentity</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">  (</span><span style="color: #FFA657">i</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">string</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">|</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">number</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">string</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">|</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">number</span></span></code></pre><p>This works if either input can produce either output, but if there is a 1:1 relationship between input and output, then we will need something different. For that, what we really want is a type like this:</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">type</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">stringOrNumberIdentity</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">  (</span><span style="color: #FFA657">str</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">string</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">string</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">|</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">n</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">number</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">number</span></span></code></pre><p>We can accomplish this with two <code>zod</code> function schemas, and then parsing the argument using each schema’s <code>parameters()</code> api. <code>parameters()</code> returns the Zod schema for the input args:</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">strIdentity</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> z.</span><span style="color: #D2A8FF">function</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">args</span><span style="color: #C9D1D9">(z.</span><span style="color: #D2A8FF">string</span><span style="color: #C9D1D9">())</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">returns</span><span style="color: #C9D1D9">(z.</span><span style="color: #D2A8FF">string</span><span style="color: #C9D1D9">())</span></span>
<span class="line"><span style="color: #C9D1D9">  </span></span>
<span class="line"><span style="color: #8B949E">// schema for the args of strIdentity</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">strInput</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> strIdentity.</span><span style="color: #D2A8FF">parameters</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  </span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">numIdentity</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> z.</span><span style="color: #D2A8FF">function</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">args</span><span style="color: #C9D1D9">(z.</span><span style="color: #D2A8FF">number</span><span style="color: #C9D1D9">())</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">returns</span><span style="color: #C9D1D9">(z.</span><span style="color: #D2A8FF">number</span><span style="color: #C9D1D9">())</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">myFn</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9">.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">identityWithValidation</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> z.</span><span style="color: #D2A8FF">function</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">args</span><span style="color: #C9D1D9">(stringOrNumber)</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">returns</span><span style="color: #C9D1D9">(stringOrNumber)</span></span>
<span class="line"><span style="color: #C9D1D9">  .</span><span style="color: #D2A8FF">implement</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">i</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (strInput.</span><span style="color: #D2A8FF">safeParse</span><span style="color: #C9D1D9">(i).success)</span></span>
<span class="line"><span style="color: #C9D1D9">       </span><span style="color: #8B949E">// parse i/o as string</span></span>
<span class="line"><span style="color: #C9D1D9">       </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> strIdentity.</span><span style="color: #D2A8FF">implement</span><span style="color: #C9D1D9">(myFn)(i)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// parse i/o as number</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> numIdentity.</span><span style="color: #D2A8FF">implement</span><span style="color: #C9D1D9">(myFn)(i)</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span></code></pre><p>With this, we can enforce a 1:1 relationship between input and output, for an overloaded function.</p><h2 id="conclusion">Conclusion</h2><p>A system will need some sort of runtime validation eventually. Consider separating your validation logic into composable pieces using a library like <code>zod</code></p>
    </article>  
  </div>
      </main>
    <footer>
  <div class="bg-accent py-4 flex justify-center">
    <div class="text-white">
      <a href="https://github.com/TillaTheHun0/astro-blog">Source Code</a> - © Copyright 2022
    </div>
  </div>
</footer>
  </body></html>
